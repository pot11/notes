### 一，数据库

#### 1.1 概念

> 数据库就是存储数据的仓库
>
> 数据库可以实现数据的持久化存储
>
> 数据库的本质是文件系统

#### 1.2 DBMS 

> Database Management System 数据库管理系统
>
> DBMA：数据库管理员
>
> 常见的数据库管理系统：
>
> 1. **MySQL**：Oracle 公司的中小型数据库，从6版本开始收费
> 2. **Oracle**：Oracle 公司的大型数据库，收费的
> 3. DB2：IBM 公司的大型数据库
> 4. SQLServer：Mircosoft 公司的大型数据库
> 5. SQLite：移动端的嵌入式小型数据库

#### 1.3 数据存储的结构

> 一个DBMS中维护管理者若干个数据库
>
> 一个数据库由若干张表组成
>
> 一张表包含若干条记录
>
> 一条记录包含若干字段

### 二， SQL语言

> SQL：Structured Query Language 结构化查询语言
>
> CRUD：create read update delete
>
> 分类：
>
> 1. DDL：数据定义语言
>
>    对数据库、数据库的表进行创建、修改、删除等操作
>
> 2. DML：数据操作语言
>
>    对表中记录、表中字段进行增、删、改
>
> 3. DQL：数据查询语言
>
>    对数据库、表、记录、字段进行查询的
>
> 4. DCL：数据库控制语言
>
>    对数据库的安全级别和访问权限进行管理

#### 2.1 库的操作

> 建库：
>
> ```sql
> create database 库名;
> ```
>
> 判断数据库是否存在，不存在才创建：
>
> ```sql
> create database if not exists 库名;
> ```
>
> 查看数据库的创建语句以及编码格式：
>
> ```sql
> show create database 库名;
> ```
>
> 创建数据库的同时指明编码格式：
>
> ```sql
> create database 库名 character set 编码格式;
> ```
>
> 判断数据库是否存在，不存在才创建，创建时指明编码格式：
>
> ```sql
> create database if not exists 库名 character set 编码格式;
> ```
>
> 查看所有数据库：
>
> ```sql
> show databases;
> ```
>
> 删库：
>
> ```sql
> drop database 库名;
> ```
>
> 判断数据库是否存在，存在才删除：
>
> ```sql
> drop database if exists 库名;
> ```
>
> 修改数据库的编码格式：
>
> ```sql
> alter database 库名 character set 编码格式;
> ```
>
> 使用指定的数据库：
>
> ```sql
> use 库名;
> ```

#### 2.2 表的操作

> 建表：
>
> ```sql
> create table 表名 (字段名 字段类型 [约束], 字段名 字段类型 [约束], ...);
> ```
>
> 判断表是否存在，不存在才创建：
>
> ```sql
> create table if not exists 表名 (字段名 字段类型 [约束], 字段名 字段类型 [约束], ...);
> ```
>
> 查看所有表：
>
> ```sql
> show tables;
> ```
>
> 删表：
>
> ```sql
> drop table 表名;
> ```
>
> 判断表是否存在，存在才删除：
>
> ```sql
> drop table if exists 表名;
> ```
>
> 查看表结构：
>
> ```sql
> desc 表名;
> ```
>
> 复制表结构：
>
> ```sql
> create table 新表名 like 被复制的表名; 
> ```
>
> 修改表名：
>
> ```sql
> alter table 旧表名 rename to 新表名;
> ```

> 修改表结构：
>
> 1. 添加新字段
>
>    ```sql
>    alter table 表名 add 新字节 字段类型 [约束];
>    ```
>
> 2. 删除字段
>
>    ```sql
>    alter table 表名 drop 字段;
>    ```
>
> 3. 修改字段类型
>
>    ```sql
>    alter table 表名 modify 字段 字段类型 [约束];
>    ```
>
> 4. 修改字段名
>
>    ```sql
>    alter table 表名 change 旧字段名 新字段名 字段类型 [约束];
>    ```

#### 2.3 记录、字段的操作

> 查询表中的所有记录：
>
> ```sql
> select * from 表名;
> * 表示所有字段
> ```

> 添加记录：
>
> 1. 向指定字段添加数据
>
>    ```sql
>    insert into 表名 (字段1,字段2,字段3,...) values (值1,值2,值3,...);
>    ```
>
> 2. 向所有字段添加数据
>
>    ```sql
>    insert into 表名 values (值1,值2,值3,...);
>    ```
>
> 3. 批量添加（指定字段）
>
>    ```sql
>    insert into 表名 (字段1,字段2,字段3,...) values (值1,值2,值3,...),  (值1,值2,值3,...),...;
>    ```
>
> 4. 批量添加（所有字段）
>
>    ```sql
>    insert into 表名 values (值1,值2,值3,...),(值1,值2,值3,...),...;
>    ```

> 删除记录：
>
> 1. 删除所有记录
>
>    ```sql
>    delete from 表名;
>    ```
>
> 2. 根据条件删除指定记录
>
>    ```sql
>    delete from 表名 where 条件;
>    ```
>
> 3. 删除所有记录
>
>    ```sql
>    truncate table 表名;
>    ```

> 修改记录：
>
> 1. 修改所有记录
>
>    ```sql
>    update 表名 set 字段名 = 值 , 字段名 = 值,...;
>    ```
>
> 2. 根据条件修改指定记录
>
>    ```sql
>    update 表名 set 字段名 = 值 , 字段名 = 值,... where 条件; 
>    ```



> 注：
>
> 1. 向指定字段添加数据时，值的顺序必须与 values 前字段的顺序一致
>
> 2. 向所有字段添加数据时，值的顺序必须和表中字段的顺序一致
> 3. 值的类型必须和字段类型一致
> 4. 值的数量必须和字段数量一致
> 5. delete from 表名；作用是删除表中所有记录，它的删除方式是逐行删除，表中有多少条记录就执行多少次删除语句。truncate table 表名；作用也是删除表中的所有记录，它的删除方式是将整张表删除，然后构建一张结构相同的空表。
> 6. 除了数值类型，其他类型都必须使用引号括起来

#### 2.4 查询

##### 2.4.1 基础查询

> 1. 查询所有记录的所有字段
>
>    ```sql
>    select * from 表名;
>    ```
>
> 2. 查询所有记录的指定字段
>
>    ```sql
>    select 字段1,字段2,... from 表名;
>    ```
>
> 3. 起别名
>
>    ```sql
>    as 别名
>    as 可以省略
>    ```
>
> 4. 去重查询
>
>    ```sql
>    select distinct 字段 from 表名;
>    ```

##### 2.4.2 条件查询

> 使用 where 关键字，并在 where 后跟上条件，查询时会根据条件对记录进行筛选，符合条件的才会被查出
>
> 1. 逻辑运算符
>
>    ```sql
>    &&,and
>    ||,or
>    !
>    ```
>
> 2. 关系运算符
>
>    ```sql
>    >
>    >=
>    <
>    <=
>    =
>    !=,<>
>    ```
>
> 3. 指定列表内
>
>    ```sql
>    in (值1,值2,值3,...)
>    ```
>
>    不在指定列表内
>
>    ```sql
>    not in (值1,值2,值3,...)
>    ```
>
> 4. 指定范围内
>
>    ```sql
>    between ... and ...
>    ```
>
>    注：
>
>    1. 含头含尾
>    2. 和 in 的区别是，in：只有在列表中出现的才能被查询到，between and ：只要在范围中的就能被查询到
>
> 5. 空和非空
>
>    ```sql
>    判断空：is null
>    判断非空：is not null
>    ```
>
> 6. 模糊查询
>
>    ```sql
>    关键字：like
>    占位符：
>    1. _：单个任意字符
>    2. %：任意个任意字符
>    ```

#### 2.5 排序查询

> 关键字：order by
>
> 使用方式：order by 字段 排序方式
>
> 排序方式：
>
> 1. 升序：默认，asc
> 2. 降序：desc
>
> 注：多个字段的排序，只有第一字段的值相同时，才会执行第二字段排序
>
> ```sql
> order by 字段1 排序方式 , 字段2 排序方式;
> ```

#### 2.6 聚合函数

> 将一列作为一个整体，进行纵向计算
>
> 1. avg()：求平均值
> 2. sum()：求和
> 3. max()：求最大值
> 4. min()：求最小值
> 5. count()：求个数
>
> 注：
>
> 1. 聚合函数不计算 null 值
> 2. count()的参数一般使用 * 或者非空字段

#### 2.7 分组查询

> 关键字：group by
>
> 使用：group by 分组字段
>
> 注：
>
> 1. 分组后查询的字段只能是：分组字段、聚合函数
> 2. where 和 having 的区别：
>    1. where 用于分组前进行条件筛选，不满足 where 条件的不进入分组；having 用于分组后进行条件筛选，不满足 having 条件的不会被查询到
>    2. where 后不能使用聚合函数，having 后可以使用聚合函数

#### 2.8 分页查询

> 关键字：limit
>
> 使用：limit 开始索引，每页查询的记录数
>
> 公式：开始索引 = (查询的页码 - 1) * 每页的记录数

#### 2.9 查询语句的结构

> select
>
>  字段列表
>
> from
>
> ​	表名
>
> where
>
> ​	条件列表
>
> group by
>
> ​	分组字段
>
> having
>
> ​	分组后的条件
>
> order by
>
> ​	排序字段 排序方式
>
> limit
>
> ​	索引，记录数

#### 2.10 约束

> 对表中字段进行限定
>
> 分类：
>
> 1. 非空约束：not null
> 2. 唯一约束：unique
> 3. 主键约束：primary key
> 4. 外键约束：foreign key

##### 2.10.1 非空约束：not null

> 限定字段值不能为空
>
> 1. 建表时，添加非空约束
>
>    ```sql
>    create table 表名 (字段名 字段类型 not null, 字段名 字段类型 [约束], ...);
>    ```
>
> 2. 建表后，添加非空约束
>
>    ```sql
>    alter table 表名 modify 字段名 字段类型 not null;
>    ```
>
>    注：已存在空值的字段不能被修改成非空的
>
> 3. 删除非空约束
>
>    ```sql
>    altert table 表名 modify 字段名 字段类型;
>    ```
>
> 4. 建表后，添加新字段的同时设置其为非空
>
>    ```sql
>    alter table 表名 add 字段名 字段类型 not null;
>    ```

##### 2.10.2 唯一约束：unique

> 限定字段值不能有重复
>
> 1. 建表时，添加唯一约束
>
>    ```sql
>    create table 表名 (字段名 字段类型 unique, 字段名 字段类型 [约束], ...);
>    ```
>
> 2. 建表后，添加唯一约束
>
>    ```sql
>    alter table 表名 modify 字段名 字段类型 unique;
>    ```
>
>    注：已存在重复值的字段不能被修改成唯一的
>
> 3. 建表后，添加新字段的同时设置其为唯一
>
>    ```sql
>    alter table 表名 add 字段名 字段类型 unique;
>    ```
>
> 4. 删除唯一约束
>
>    ```sql
>    alter table 表名 drop index 字段名;
>    ```
>
> 注：
>
> 1. 一个字段可以同时被设置成非空且唯一的，并且非空和唯一的关键字的顺序是任意的
> 2. 唯一约束的字段值可以是空值，并且允许存在多个空值

##### 2.10.3 主键约束：primary key

> 一般将不具有特殊含义且要用于表示唯一性的字段设置成主键
>
> 主键的特点：
>
> 1. 非空且唯一
> 2. 一张表中只能有一个主键字段
> 3. 主键是表中记录的唯一标识

> 1. 建表时，添加主键约束
>
>    ```sql
>    create table 表名 (字段名 字段类型 primary key, 字段名 字段类型 [约束], ...);
>    create table 表名(字段名 字段类型 [约束], 字段名 字段类型 [约束], ... , primary key(主键字段));
>    ```
>
> 2. 建表后，添加主键约束
>
>    ```sql
>    alter table 表名 modify 字段名 字段类型 primary key;
>    ```
>
> 3. 删除主键约束
>
>    ```sql
>    alter table 表名 drop primary key;
>    ```
>
>    注：删除主键约束后，该字段仍有非空约束

> 主键自增长：
>
> 概念：主键自增长是 MySQL 的方言，可以使用 auto_increment 实现主键的自增长。
>
> 1. 建表时，添加主键自增长
>
>    ```sql
>    create table 表名 (字段名 字段类型 primary key auto_increment, 字段名 字段类型 [约束], ...);
>    ```
>
> 2. 建表后，添加主键自增长
>
>    ```sql
>    alter table 表名 modify 主键字段 字段类型 auto_increment;
>    ```
>
> 3. 建表后，将字段设置成主键字段并设置其为自增长的
>
>    ```sql
>    alter table 表名 modify 字段名 字段类型 primary key auto_increment;
>    ```
>
> 4. 建表后，添加新字段，将其设置成主键并自增长
>
>    ```sql
>    alter table 表名 add 字段名 字段类型 primary key auto_increment;
>    ```
>
> 5. 删除主键自增长
>
>    ```sql
>    alter table 表名 modify 主键字段 字段类型;
>    ```
>
> 注：
>
> 1. 只有主键可以被设置成主键自增长
>
> 2. 只有数值类型的主键可以被设置成主键自增长
> 3. 第一条自增长的字段值是 1
> 4. 自增长从存在过的最大值开始 +1
> 5. 如果主键是小数，那么自增长的值是存在过的最大值四舍五入后 +1

##### 2.10.4 外键约束

> 外键让表与表之间产生了联系，保证了数据的完整性
>
> 表与表之间的关系有：
>
> 1. 一对一（了解）
>
> 2. 一对多（多对一）
> 3. 多对多
>
> 在一对多的情况下，一的一方称为主表，多的一方称为从表，将两张表建立关系，需要在从表中添加外键指向主表的主键。
>
> 在多对多的情况下，两张表都是主表，需要建立一张中间表，这个中间表至少包含两个字段，分别指向两张主表的主键。
>
> 注：从表外键的数据类型必须和主表主键的数据类型一致

> 1. 建表时，添加外键约束
>
>    ```sql
>    create table 从表名 (字段名 字段类型 [约束], 字段名 字段类型 [约束], ..., [constraint 外键名] foreign key(外键字段) references 主表(主表的主键字段));
>    ```
>
> 2. 删除外键
>
>    ```sql
>    alter table 从表名 drop foreign key 外键名;
>    ```
>
> 3. 建表后，添加外键约束
>
>    ```sql
>    alter table 从表名 add [constraint 外键名] foreign key(外键字段) references 主表(主表的主键字段);
>    ```
>
> 4. 建表后，新建外键字段的同时，添加外键约束
>
>    ```sql
>    alter table 从表名 add 外键字段 字段类型, add [constraint 外键名] foreign key(外键字段) references 主表(主表的主键字段);
>    ```

> 级联操作：
>
> 对主表中的记录进行修改或者删除的同时，会直接影响从表中的记录
>
> 1. 创建从表时，添加级联操作
>
>    ```sql
>    create table 从表名 (字段名 字段类型 [约束], 字段名 字段类型 [约束], ..., [constraint 外键名] foreign key(外键字段) references 主表(主表的主键字段) on delete cascade on update cascade  );
>    ```
>
> 2. 创建从表后，添加外键约束的同时添加级联操作
>
>    ```sql
>    alter table 从表名 add [constraint 外键名] foreign key(外键字段) references 主表(主表的主键字段) on delete cascade on update cascade;
>    ```
>
> 3. 创建从表后，新建外键字段，添加外键约束，并添加外键的级联操作
>
>    ```sql
>    alter table 从表名 add 外键字段 字段类型, add [constraint 外键名] foreign key(外键字段) references 主表(主表的主键) on delete cascade on update cascade;
>    ```

> 多对多的情况，在中间表中建立外键指向两张表的主键：
>
> 创建中间表：
>
> ```sql
> create table 表名 (字段名1 字段类型, 字段名2 字段类型, primary key(字段名1,字段名2), foreign key(字段1) references 主表1(主表1的主键字段), foreign key(字段2) references 主表2(主表2的主键字段));
> ```
>
> 

#### 2.11 子查询

##### 2.11.1 将子查询的结果作为条件

> 注：
>
> 1. 将子查询查询到的 “一行一列” 的结果作为外部查询的条件
> 2. 子查询查询到的一行一列的结果与外部查询的条件使用等值或者不等值的条件进行判断

##### 2.11.2 将查询结果作为枚举的查询条件

> 注：
>
> 1. 将子查询查询到的 “多行一列” 的结果作为外部查询的条件
> 2. 在再外部查询时使用 in 进行查询

##### 2.11.3 将查询结果作为一张表进行查询

> 注：
>
> 1. 将子查询查询到的 “多行多列” 的结果作为外部查询的一张表
> 2. 给这张表起别名，在这张表上进行查询

#### 2.12 多表查询

##### 2.12.1 交叉查询

> 语法：
>
> ```sql
> select 字段列表 from 表1, 表2;
> ```
>
> 注：
>
> 1. 交叉查询的结果是笛卡尔积，是多张表所有记录的组成情况
> 2. 需要使用条件来清除无效数据

##### 2.12.2 内连接查询

> 在交叉查询的基础上使用 where 条件清除无效的数据
>
> 语法：
>
> 1. 隐式内连接
>
> ```sql
> select 字段列表 from 表1, 表2 where 条件;
> ```
>
> 2. 显式内连接
>
> ```sql
> select 字段列表 from 表1 inner join 表2 where 条件;
> ```
>
> 注：
>
> 1. inner 可以省略
> 2. where 可以换成 on，但是使用 on 时，不能再将显式内连接写成隐式内连接

##### 2.12.3 外连接查询

> 语法：
>
> 1. 左外连接
>
>    ```sql
>    select 字段列表 from 表1 left outer join 表2 on 条件;
>    ```
>
> 2. 右外连接
>
>    ```sql
>    select 字段列表 from 表1 right outer join 表2 on 条件;
>    ```
>
> 注：
>
> 1. outer 可以省略
> 2. 外连接查询条件的关键字只能用 on
> 3. 左外连接查询的结果是左表的全部和两表的交集
> 4. 右外连接查询的结果是右表的全部和两表的交集
> 5. 内连接查询的结果是两表的交集

















