回表

2020年5月6日

17:12

 

> [回表：非主键联合索引的b+树叶子节点上，没有数据库完整的数据，叶子节点挂载着主键id，然后通过id，到主键索引b+树上 查询完整的数据。]{.mark}
>
>  
>
> MySQL innodb的主键索引是簇集索引，也就是索引的叶子节点存的是整个单条记录的所有字段值，不是主键索引的就是非簇集索引，非簇集索引的叶子节点存的是主键字段的值。回表是什么意思？就是你执行一条sql语句，需要从两个b+索引中去取数据。举个例子：
>
> 表tbl有a,b,c三个字段，其中a是主键，b上建了索引，然后编写sql语句
>
> SELECT \* FROM tbl WHERE a=1
>
> 这样不会产生回表，因为所有的数据在a的索引树中均能找到
>
> SELECT \* FROM tbl WHERE b=1
>
> 这样就会产生回表，因为where条件是b字段，那么会去b的索引树里查找数据，但b的索引里面只有a,b两个字段的值，没有c，那么这个查询为了取到c字段，就要取出主键a的值，然后去a的索引树去找c字段的数据。查了两个索引树，这就叫回表。
>
> 索引覆盖就是查这个索引能查到你所需要的所有数据，不需要去另外的数据结构去查。其实就是不用回表。
>
> 怎么避免？不是必须的字段就不要出现在SELECT里面。或者b,c建联合索引。但具体情况要具体分析，索引字段多了，存储和插入数据时的消耗会更大。这是个平衡问题。
>
>  
>
> 比如说你建立了一个A，B联合索引，你的sql语句是 select A，B from table where A=xxx, B=xxx你会发现你想要搜索的A，B从索引数据中已经存在了，压根不用拿到id到表数据中去查找，此时便不会回表，这种现象就叫做索引覆盖。
>
> 现在你把语句改为了 select A，B，C from table where A=xxx, B=xxx，C毕竟不在索引数据中，拿不到，那只能先拿到id再导表数据文件中搜索，此时就是回表
>
> 避免回表：

1.  用主键搜索

2.  只查询被联合索引覆盖的字段

>  
