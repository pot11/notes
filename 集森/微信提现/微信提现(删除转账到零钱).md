# 加密相关

## API v3密钥

1. 为了保证安全性，微信支付在 回调通知和平台证书下载接口中，对关键信息进行了AES-256-GCM加密。API v3密钥是加密时使用的对称密钥  
2. 商户需先在【商户平台】->【账户中心】->【API安全】的页面设置该密钥，请求才能通过微信支付的签名校验。密钥的长度为32个字节。
3. ![alt text](image.png)  
4. 这个错误通常与Java中使用的加密库有关，具体来说是由于Java运行时环境（JRE）的政策限制了某些密钥长度。在某些地区，由于出口法规的限制，默认情况下Java只支持有限长度的密钥（通常是128位）。如果你的应用程序尝试使用更长的密钥（例如256位），则会抛出java.security.InvalidKeyException: Illegal key size异常。

要解决这个问题，你需要安装Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files。这是一组额外的策略文件，可以让你的JRE支持任意长度的密钥。以下是安装步骤：

确定你正在使用的JDK版本。
下载对应版本的JCE Unlimited Strength Jurisdiction Policy Files：
对于JDK 8：JCE 8  

```url
https://www.oracle.com/java/technologies/javase-jce8-downloads.html?spm=5176.28103460.0.0.40f75d27ZfgUYz  
```  

对于更新的版本，请查找相应版本的下载链接。
解压下载的文件，你会看到两个.jar文件：local_policy.jar和US_export_policy.jar。
找到你的JDK安装目录下的jre/lib/security/文件夹，并用解压出来的两个.jar文件替换原有的同名文件。
重启你的应用程序或IDE以使更改生效。
完成以上步骤后，你应该能够使用任何长度的密钥而不会遇到“非法密钥大小”的错误。

请注意，从JDK 9开始，无限强度的加密策略已经成为默认设置，因此对于JDK 9及以上版本，你不需要再单独下载和安装这些策略文件。

如果你已经确认JCE无限制策略文件已正确安装，但仍然遇到此问题，请检查是否有其他安全配置或自定义的安全管理器可能影响了密钥的使用。

申请了商户api证书后，微信平台证书需要调用接口下载

![alt text](image-4.png)
![alt text](image-6.png)
![alt text](image-7.png)