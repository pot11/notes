Spring 事务在哪几种情况下会失效？为什么？

2023年11月9日

16:24

 

1.  非事务方法调用事务方法会失效；数据库不支持事务；自己手动捕获了异常没有抛出。

> 1.数据库不支持事务
>
> 2.类没有被spring管理
>
> 3.方法不是public修饰的
>
> 4.异常捕获后没有抛出
>
> 5.方法被final修饰
>
> 6.非事务方法调用事务方法
>
> 7.回滚属性设置错误
>
> 8.配置中没有开启事务
>
> 9.多线程
>
>  
>
>  
>
> 1.@Transactional注解设置为不开启事务/需要回滚的异常被catch
>
> 2.spring事务是通过aop实现的，调用的不是代理后的方法事务就会失效，代理失效的情况有 final方法、static方法、被同一个类中的其他方法调用或调用内部类方法、private方法。
>
> 3.存储引擎不支持事物如myisam
>
>  
>
>  
>
> 大概列举几种情况
>
> 1\. 直接new出来的对象添加事务不起作用，因为只有spring定义的bean才接受事务。
>
> 2.由于mysql的引擎用Myisam不支持事务，所以如果使用mysql的myisam引擎的话，事务不起作用。
>
> 3.如果@Transaction注解到非public方法上，事务不起作用，这是因为spring的Aop特性。
>
> 4.如果在当前类中进行内部调用方法，比如在A类中有a方法和b方法，a方法没有加@Transaction，b方法加了@Transaction，在方法a中调用方法b，方法b中的事务也不会生效。这是因为spring在扫描bean的时候会自动为标注了@Transaction注解类生成一个代理类，在有注解方法被调用时，实际上是代理类调用的，代理类在调用之前会开启事务，执行事务操作。但是同类中的方法相互调用，相当于this.b（），此时的b方法并非代理类调用，而是直接通过原有的bean直接调用，所以注解不起作用。
>
> 5.异常类型错误，如果抛出的runtimeException事务才会回滚。
>
> 6.如果异常被catch到，必须要抛出异常，事务才会回滚。
>
>  
>
>  
>
>  
>
>  
